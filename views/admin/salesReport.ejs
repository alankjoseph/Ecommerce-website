<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
        integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css" />

</head>

<body>
    <%- include('../partials/adminNav.ejs') %>
        <section class="body-section col-md-10 ms-sm-auto me-lg-2 me-md-2 col-lg-10 px-md-4 mt-3">
            <h3 class="i-names">Sales Report</h3>
            <div class="table-top container mb-5 mt-4 d-flex justify-content-center">
                <div>
                    <h4>Today</h4>
                </div>
            </div>
            <div class="container">
                <div class="table-responsive">
                    <table class="table table-bordered align-middle" id="today-table">
                        <thead>
                            <tr class="text-center">
                                <th scope="col">Order Id</th>
                                <th scope="col">Customer</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Status</th>
                                <th scope="col">Order Status</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            <% today.forEach(element=> { %>
                                <tr>
                                    <td>
                                        <%= element.order_id %>
                                    </td>
                                    <td>
                                        <%= element.user.firstName %>
                                    </td>
                                    <td>
                                        <%= element.finalAmount %>
                                    </td>
                                    <td>
                                        <%= element.paymentStatus %>
                                    </td>
                                    <td>
                                        <%= element.orderStatus %>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-center">
                        <button class="btn btn-danger" id="today-btn" <% if (today.length==0) { %>
                            disabled
                            <% } %>
                                onclick="CreatePDFfromHTML('today-table')"
                                >
                                Download As PDF
                        </button>
                    </div>
                </div>
            </div>

            <div class="table-top container mb-5 mt-4 d-flex justify-content-center mt-5">
                <div>
                    <h4>This Month</h4>
                </div>
            </div>
            <div class="container">
                <div class="table-responsive">
                    <table class="table table-bordered align-middle" id="month-table">
                        <thead>
                            <tr class="text-center">
                                <th scope="col">Order Id</th>
                                <th scope="col">Customer</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Status</th>
                                <th scope="col">Order Status</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            <% month.forEach(element=> { %>
                                <tr>
                                    <td>
                                        <%= element.order_id %>
                                    </td>
                                    <td>
                                        <%= element.user.firstName %>
                                    </td>
                                    <td>
                                        <%= element.finalAmount %>
                                    </td>
                                    <td>
                                        <%= element.paymentStatus %>
                                    </td>
                                    <td>
                                        <%= element.orderStatus %>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-center">
                        <button class="btn btn-danger" id="today-btn" <% if (month.length==0) { %>
                            disabled
                            <% } %>
                                onclick="CreatePDFfromHTML('month-table')"
                                >
                                Download As PDF
                        </button>
                    </div>
                </div>
            </div>

            <div class="table-top container mb-5 mt-4 d-flex justify-content-center mt-5">
                <div>
                    <h4>This Year</h4>
                </div>
            </div>
            <div class="container">
                <div class="table-responsive">
                    <table class="table table-bordered align-middle" id="year-table">
                        <thead>
                            <tr class="text-center">
                                <th scope="col">Order Id</th>
                                <th scope="col">Customer</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Status</th>
                                <th scope="col">Order Status</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            <% year.forEach(element=> { %>
                                <tr>
                                    <td>
                                        <%= element.order_id %>
                                    </td>
                                    <td>
                                        <%= element.user.firstName %>
                                    </td>
                                    <td>
                                        <%= element.finalAmount %>
                                    </td>
                                    <td>
                                        <%= element.paymentStatus %>
                                    </td>
                                    <td>
                                        <%= element.orderStatus %>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-center">
                        <button class="btn btn-danger mb-5" id="today-btn" <% if (year.length==0) { %>
                            disabled
                            <% } %>
                                onclick="CreatePDFfromHTML('year-table')"
                                >
                                Download As PDF
                        </button>
                    </div>
                </div>
            </div>
        </section>
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>

        <script>
            $(document).ready(function () {
                $('#tableForm').DataTable();
            });
        </script>
        <script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
        <script>


            function CreatePDFfromHTML(id) {
                const HTML_Width = $(`#${id}`).width();
                const HTML_Height = $(`#${id}`).height();
                const top_left_margin = 15;
                const PDF_Width = HTML_Width + top_left_margin * 2;
                const PDF_Height = PDF_Width * 1.5 + top_left_margin * 2;
                const canvas_image_width = HTML_Width;
                const canvas_image_height = HTML_Height;
                const totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;
                html2canvas($(`#${id}`)[0]).then((canvas) => {
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    const pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
                    pdf.addImage(
                        imgData,
                        'JPG',
                        top_left_margin,
                        top_left_margin,
                        canvas_image_width,
                        canvas_image_height,
                    );
                    for (let i = 1; i <= totalPDFPages; i++) {
                        pdf.addPage(PDF_Width, PDF_Height);
                        pdf.addImage(
                            imgData,
                            'JPG',
                            top_left_margin,
                            -(PDF_Height * i) + top_left_margin * 4,
                            canvas_image_width,
                            canvas_image_height,
                        );
                    }
                    pdf.save(
                        'Sales_Report.pdf',
                    );
                });
            }
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
</body>

</html>